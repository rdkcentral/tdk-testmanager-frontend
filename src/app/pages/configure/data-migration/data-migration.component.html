<!--
* If not stated otherwise in this file or this component's LICENSE file the
* following copyright and licenses apply:
*
* Copyright 2024 RDK Management
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*
http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
-->

<div class="container-fluid" style="overflow-x: hidden">
  <div class="row mt-2 mb-4">
    <div class="col-12">
      <h1 class="view-title">Data Migration</h1>
    </div>
  </div>
  
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Check for New Changes</h5>
      <div class="row">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Since Date/Time</mat-label>
            <input
              matInput
              type="datetime-local"
              [(ngModel)]="sinceDateTime"
              [disabled]="operationInProgress"
              matTooltip="Select date and time to check for changes since"
            >
          </mat-form-field>
          <div class="mb-2">
            <small class="text-muted">Enter time in the browser time zone, current time is {{ getCurrentTimeString() }}</small>
          </div>
        </div>
        <div class="col-md-6 d-flex align-items-start">
          <div>
            <button
              class="modal-btns me-2"
              (click)="checkForNewChanges()"
              [disabled]="operationInProgress || !sinceDateTime"
              matTooltip="Fetch changes since selected date/time"
            >
              Fetch Changes
            </button>
            <button
              class="modal-btns"
              (click)="downloadChanges()"
              [disabled]="operationInProgress || !sinceDateTime"
              matTooltip="Download changes as SQL file"
            >
              Download Changes
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="logsection">
      <span class="sub-titel" style="color: #06667d">Operation Output</span>
      
      <div class="execution-result">
        <div class="logs-content">
          <div *ngIf="operationInProgress" class="alert alert-info mt-3">
            <i class="bi bi-hourglass-split me-2"></i>
            Operation is in progress. Please wait.
          </div>
          
          <ng-container *ngIf="outputLogs; else noLogs">
            <div class="upgradation-logs" [innerHTML]="getFormattedLogs()"></div>
          </ng-container>
          
          <ng-template #noLogs>
            <div class="text-muted mt-3">
              No logs available. Output will appear here during operations.
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4 mb-4">
    <div class="buttn-grp">
      <button
        class="modal-btns"
        (click)="close()"
        matTooltip="Close the dialog"
      >
        Close
      </button>
    </div>
  </div>
</div>