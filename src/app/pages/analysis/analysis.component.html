<!--
If not stated otherwise in this file or this component's Licenses.txt file the
following copyright and licenses apply:
Copyright 2024 RDK Management
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!-- Main container for analysis report page -->
<div class="container-fluid report-bg">
    <!-- Row for report header and title -->
    <div class="row borders-btm">
        <!-- Column for flavor selection -->
        <div class="col-md-5">
            <!-- Row for flavor dropdown -->
            <div class="row ">
              <!-- Row for RDK flavor dropdown -->
              <div class="falvor-row">
                <span for="falvor" class="falvor-label">RDK flavor :</span>
                    <select class="form-select rdk-dropdown" aria-label="Default select example" id="preferCategoty"
                        [(ngModel)]="selectedDfaultCategory" (change)="categoryChange($event)">
                        <option value="RDKV">Video</option>
                        <option value="RDKB">Broadband</option>
                    </select>
              </div>
              </div>
        </div>
        <!-- Column for result analysis title -->
        <div class="col-md-2">
            <h1 class="title">Result Analysis</h1>
        </div>
        <!-- Empty column for spacing -->
        <div class="col-md-5">
        </div>
    </div>
    <!-- Row for main section and tabs -->
    <div class="row main-sec mt-1">
    
    <!-- Container for tab group and report cards -->
    <div  [ngClass]="this.tabName === 'Combined Report'?'card-combine':'radiobox-row'">
        <!-- Row for tab group main margin -->
        <div class="row mt-2 main-margin">
            <mat-tab-group animationDuration="0ms" mat-align-tabs="start" (selectedTabChange)="onTabClick($event)">
                <mat-tab label="Comparsion Report">
                    <!-- Report section for comparison report -->
                    <div class="report-section" [ngClass]="this.tabName === 'Combined Report'?'hegiht-body':'height-comp'">
                        <form [formGroup]="reportForm" (ngSubmit)="compReportSubmit()"> 
                        <!-- Row for base execution name input -->
                        <div class="mb-3 row-align">
                            <label for="testtype" class="col-md-3 col-form-label">Base Execution Name <span
                                    style="color:red; margin-left: 0.75em;">*</span>
                                <span class="thunderport-info"><i class="bi bi-info-circle info-icon"
                                        matTooltip="Select one execution for adding it as base execution"></i></span>
                            </label>
                            <!-- Column for base execution name input field -->
                            <div class="col-md-5">
                                <input type="text" class="form-control" [(ngModel)]="selectExecutionName" formControlName="baseName"
                                    placeholder="Enter base execution name">
                                <div *ngIf="reportSubmitted && reportForm.controls['baseName']?.errors" class="text-danger">
                                    <small *ngIf="reportForm.controls['baseName']?.errors?.['required']">Give one execution name or
                                        choose.</small>
                                </div>
                            </div>
                            <!-- Column for OR and choose button -->
                            <div class="col-md-3 text-center">
                                <span class="ortext">OR</span><button type="button" class="create-btn" (click)="openModal()">Choose</button>
                            </div>
</div>
                        <!-- Row for comparison execution names input -->
                        <div class="mt-4 mb-3 row-align">
                            <label for="testtype" class="col-md-3 col-form-label">Comparison Execution Names <span
                                style="color:red; margin-left: 0.75em;">*</span>
                                <span class="thunderport-info"><i class="bi bi-info-circle info-icon" matTooltip ="Select 1- 10 executions for the comparison report"></i></span>
                            </label>
                            <!-- Column for comparison execution names textarea -->
                            <div class="col-md-5">
                            <textarea
                                formControlName="comparisonName"
                                (input)="updateComparisonFormValue($event)"
                                class="form-control"
                                placeholder="Enter comparison execution names separated by commas"
                                rows="5" 
                                cols="25"
                            ></textarea>
                                <div *ngIf="reportSubmitted && reportForm.controls['comparisonName']?.errors" class="text-danger">
                                    <small *ngIf="reportForm.controls['comparisonName']?.errors?.['required']">Give list of execution names separated by comma (Min: 1 and Max: 10) or choose.</small>
                                    <small *ngIf="reportForm.controls['comparisonName']?.errors?.['baseFoundInComparison']">
                                        Base Execution cannot be in the selected for comparision.
                                    </small>
                                </div>
                            </div>
                            <!-- Column for OR and choose button for comparison -->
                            <div class="col-md-3 text-center">
                                <span class="ortext">OR</span><button type="button" class="create-btn" (click)="comparisonModal()">Choose</button>
                            </div>
                        </div>
                        <!-- Column for generate comparison report button -->
                        <div class="col-md-12 text-center">
                            <button type="submit" class="create-btn" [disabled]="isDownloading">
                                {{ isDownloading ? 'Downloading...' : 'Generate Comparison Report' }}
                            </button>
                            </div>
                            <!-- Row for loader spinner (conditional) -->
                            <div class="row loader-row" *ngIf="isDownloading">
                            <app-loader></app-loader> <!-- Replace with your loader component -->
                        </div>
                    </form>
                    </div>
                </mat-tab>
                <mat-tab label="Combined Report">
                    <!-- Report section for combined report -->
                    <div class="report-section mat-mdc-tab-body-content" [ngClass]="this.tabName === 'Combined Report'?'hegiht-body':'height-comp'">
                        <form [formGroup]="combinedForm" (ngSubmit)="onCombinedSubmit()"> 
                            <!-- Row for combined report form fields -->
                            <div class="row first-row">
                                <!-- Column for from date and device type -->
                                <div class="col">
                                    <!-- Row for from date input -->
                                    <div class="mb-3 row-align">
                                        <label for="testtype" class="col-md-4 col-form-label">From <span
                                            style="color:red; margin-left: 0.75em;">*</span></label>
                                        <!-- Column for from date input field -->
                                        <div class="col-md-8">
                                            <input type="date" class="form-control" formControlName="fromDate">
                                            <div *ngIf="combinedSubmitted && combinedForm.controls['fromDate']?.errors" class="text-danger">
                                                <small *ngIf="combinedForm.controls['fromDate']?.errors?.['required']">Please select from date.</small>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Row for device type select -->
                                    <div class="mt-2 mb-3 row-align">
                                        <label for="testtype" class="col-md-4 col-form-label">Device Type <span
                                            style="color:red; margin-left: 0.75em;">*</span></label>
                                        <!-- Column for device type select field -->
                                        <div class="col-md-8">
                                            <select class="form-select" aria-label="Default select example" id="selectDevicetype"
                                                formControlName="deviceType" (change)="deviceChange($event)">
                                                <option value="" default>Select</option>
                                                @for (item of allDeviceType; track $index) {
                                                    <option value="{{item.deviceTypeName}}">{{item.deviceTypeName}}</option>
                                                }
                                            </select>
                                            <div *ngIf="combinedSubmitted && combinedForm.controls['deviceType']?.errors" class="text-danger">
                                                <small *ngIf="combinedForm.controls['deviceType']?.errors?.['required']">Please select device type.</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Column for to date and execution type -->
                                <div class="col">
                                    <!-- Row for to date input -->
                                    <div class="mb-3 row-align">
                                        <label for="testtype" class="col-md-4 col-form-label">To <span
                                            style="color:red; margin-left: 0.75em;">*</span></label>
                                        <!-- Column for to date input field -->
                                        <div class="col-md-8">
                                            <input type="date" class="form-control" formControlName="toDate">
                                            <div *ngIf="combinedSubmitted && combinedForm.controls['toDate']?.errors" class="text-danger">
                                                <small *ngIf="combinedForm.controls['toDate']?.errors?.['required']">Please select to date.</small>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Row for execution type select -->
                                    <div class="mt-2 mb-3 row-align">
                                        <label for="testtype" class="col-md-4 col-form-label">Execution Type<span
                                            style="color:red; margin-left: 0.75em;">*</span></label>
                                        <!-- Column for execution type select field -->
                                        <div class="col-md-8">
                                            <select class="form-select" aria-label="Default select example" id="selectDevicetype"
                                                formControlName="executionType" (change)="changeExecutionType($event)" >
                                                <option value="" default>Select</option>
                                                <option value="SINGLESCRIPT">Single Script</option>
                                                <option value="MULTISCRIPT">Multi Script</option>
                                                <option value="TESTSUITE">TestSuite</option>
                                                <option value="MULTITESTSUITE">Multi Testsuite</option>
                                                
                                            </select>
                                            <div *ngIf="combinedSubmitted && combinedForm.controls['executionType']?.errors" class="text-danger">
                                                <small *ngIf="combinedForm.controls['executionType']?.errors?.['required']">Please select execution type.</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Column for category, script, and testsuite -->
                                <div class="col">
                                    <!-- Row for category select -->
                                    <div class="mb-3 row-align">
                                        <label for="testtype" class="col-md-4 col-form-label">Category</label>
                                        <!-- Column for category select field -->
                                        <div class="col-md-8">
                                            <select class="form-select" aria-label="Default select example" id="selectDevicetype"
                                                formControlName="category" disable>
                                                <option value="" default>Select</option>
                                                <option value="RDKV">Video</option>
                                                <option value="RDKB">Broadband</option>
                                            </select>
                                        <div *ngIf="combinedSubmitted && combinedForm.controls['category']?.errors" class="text-danger">
                                            <small *ngIf="combinedForm.controls['category']?.errors?.['required']">Please select a
                                                category.</small>
                                        </div>
                                        </div>
                                    </div>
                                                            <!-- Row for script input (conditional) -->
                                                            <div class="mb-3 row-align" *ngIf="showScript">
                                                                <label for="scriptSingle" class="col-md-4 col-form-label">Script Name</label>
                                                                <!-- Column for script input field -->
                                                                <div class="col-md-8">
                                                                    <input type="text" class="form-control" formControlName="scriptSingle" />
                                                                </div>
                                                            </div>
                                                            <!-- Row for testsuite input (conditional) -->
                                                            <div class="mb-3 row-align" *ngIf="testSuiteShow">
                                                                <label for="testSuiteSingke" class="col-md-4 col-form-label">Test Suite Name</label>
                                                                <!-- Column for testsuite input field -->
                                                                <div class="col-md-8">
                                                                    <input type="text" class="form-control" formControlName="testSuiteSingke" />
                                                                </div>
                                                            </div>
   
                                </div>
                            </div>
                            <!-- Column for max days exceeded error message -->
                            <div class="col-md-12 selectedScript" *ngIf="combinedSubmitted && combinedForm.errors?.['maxDaysExceeded']" class="text-danger">
                                <small>Maximum number of days allowed is 30</small>
                            </div>
                            <!-- Column for filter executions button -->
                            <div class="col-md-12 ">
                                <button type="submit" class="create-btn">Filter Executions</button>
                            </div>
                   
                        </form>
                        <!-- Error message for selection (conditional) -->
                        <div *ngIf="selectionErrorMessage" class="errmsg-report" style="color: red;">
                            {{ selectionErrorMessage }}
                        </div>
                    <!-- Column for generate combined report button (conditional) -->
                    <div class="col-md-12 text-end reportbtn" *ngIf="showReportBtn">
                        <button type="submit" class="create-btn" (click)="generateReport()" [disabled]="isDownloading">
                            {{ isDownloading ? 'Downloading...' : 'Generate Combined Report' }}
                        </button>
                    </div>
                    <!-- Row for loader spinner (conditional) -->
                    <div class="row loader-row" *ngIf="isDownloading">
                        <app-loader></app-loader> <!-- Replace with your loader component -->
                    </div>
                        <!-- Table details for combined report (conditional) -->
                        <div class="tableDeatils mt-2" *ngIf="showTable">
                            <!-- Container for ag-grid table -->
                            <div class="grid-container" [class]="themeClass">
                                <ag-grid-angular
                                style="width: 100%; height: 100%;"
                                [rowData]="rowData"
                                [columnDefs]="columnDefs"
                                [defaultColDef]="defaultColDef"
                                [pagination]="true"
                                [paginationPageSize]="pageSize"
                                [paginationPageSizeSelector]="pageSizeSelector"
                                [rowHeight]="35"
                                [rowSelection]="'multiple'"
                                (gridReady)="onGridReady($event)"
                                (selectionChanged)="onSelectionChanged()"
                              ></ag-grid-angular>
                            </div>
                        </div>

                    </div>
    
                </mat-tab>
            </mat-tab-group>    
        </div>
    </div>

    </div>
</div>
